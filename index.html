<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CoreMarks - Your Bookmarks, Your Business!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le styles -->
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.1.0/css/bootstrap-combined.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .bookmark-link {
        font-size: 133%;
      }
      .bookmark-tags {
        font-size: 90%;
      }
      .bookmark-note {
        font-size: 90%;
        color: #333;
      }
      a.delete {
        color: #a00;
      }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">CoreMarks</a>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span9">
          <table id="bookmark-table" class="table table-striped">
            <tbody>
            </tbody>
          </table>
        </div><!--/span-->
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li><input type="text" placeholder="Search"></li>
            </ul>
          </div><!--/.well -->
        </div><!--/span-->
      </div><!--/row-->

    </div><!--/.fluid-container-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.1.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
var bookmarks;

// TODO implement this
function paragraphify(str) {
  return str;
}

function tableRowFromBookmark(mark) {
  var bookmarkLink, bookmarkTags, bookmarkNote, optionButton, optionMenu;
  optionMenu = $('<ul>').addClass('dropdown-menu')
    .append($('<li>').append($('<a>').attr('href', '#').attr('id', 'bookmark-edit').append('Edit')))
    .append($('<li>').append($('<a>').attr('href', '#').attr('id', 'bookmark-delete').addClass('delete').append('Delete')));
  optionButton = $('<div>').addClass('pull-right').append($('<div>').addClass('btn-group').append($('<a>').addClass('btn').addClass('dropdown-toggle').attr('data-toggle', 'dropdown').attr('href', '#').append('<i class="icon-cog"></i> <span class="caret"></span>')).append(optionMenu));
  bookmarkLink = $('<div>').addClass('bookmark-link').append($('<a>').attr('href', mark['url']).append(mark['title']));
  bookmarkTags = $('<div>').addClass('bookmark-tags');
  for (tag in mark['tags']) {
    bookmarkTags.append($('<a>').attr('href', '#').attr('id', 'tag-' + mark['tags'][tag]).append(mark['tags'][tag]))
    bookmarkTags.append(' ')
  }
  if (mark['note'] != undefined && mark['note'] != '') {
    bookmarkNote = $('<div>').addClass('bookmark-note').append(paragraphify(mark['note']));
  }
  tableRow = $('<tr>').append($('<td>').append(optionButton).append(bookmarkLink).append(bookmarkTags).append(bookmarkNote));
  $.data(tableRow, 'id', mark['id']);
  return tableRow;
}

function loadData(location) {
  $.ajax(location, {dataType: 'json'})
    .success(function (loadedData) {
      bookmarks = loadedData;
      updateSearch([], '');
    })
    .error(function (error) {
      alert("Unable to load data from " + location);
    });
}

function updateSearch(tags, query) {
  $('#bookmark-table tbody').html('');
  for (mark in bookmarks) {
    $('#bookmark-table tbody').append(tableRowFromBookmark(bookmarks[mark]));
  }
}

$(function() {
  loadData(location.hash.substring(1));
});
    </script>
  </body>
</html>
